local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera
local UserInputService = game:GetService("UserInputService")

local ESP_Enabled = false
local Aim_Enabled = false
local UI_Visible = true
local targetName = ""
local aimDistance = nil
local aimSmoothness = nil
local target = nil
local aimKey = ""
local espKey = ""

local screenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
screenGui.ResetOnSpawn = false

-- UI creation
local toggleButton = Instance.new("TextButton", screenGui)
toggleButton.Size = UDim2.new(0.1, 0, 0.06, 0)
toggleButton.Position = UDim2.new(0.45, 0, 0.02, 0)
toggleButton.Text = "By DrWhite"
toggleButton.BackgroundColor3 = Color3.new(0.8, 0.8, 0.8)
toggleButton.TextScaled = true

local guiContainer = Instance.new("Frame", screenGui)
guiContainer.Size = UDim2.new(0.3, 0, 0.2, 0)
guiContainer.Position = UDim2.new(0.35, 0, 0.7, 0)
guiContainer.BackgroundColor3 = Color3.new(0, 0, 0)
guiContainer.BorderSizePixel = 0
guiContainer.BackgroundTransparency = 1

local distanceBox = Instance.new("TextBox", guiContainer)
distanceBox.ClearTextOnFocus = false
distanceBox.Size = UDim2.new(0.5, 0, 0.3, 0)
distanceBox.Position = UDim2.new(0, 0, 0, 0)
distanceBox.PlaceholderText = "Enter distance"
distanceBox.PlaceholderColor3 = Color3.new(0, 0, 0)
distanceBox.TextScaled = true
distanceBox.Text = ""

local smoothnessBox = Instance.new("TextBox", guiContainer)
smoothnessBox.ClearTextOnFocus = false
smoothnessBox.Size = UDim2.new(0.5, 0, 0.3, 0)
smoothnessBox.Position = UDim2.new(0.5, 0, 0, 0)
smoothnessBox.PlaceholderText = "Enter smoothness"
smoothnessBox.PlaceholderColor3 = Color3.new(0, 0, 0)
smoothnessBox.TextScaled = true
smoothnessBox.Text = ""

local nameBox = Instance.new("TextBox", guiContainer)
nameBox.ClearTextOnFocus = false
nameBox.Size = UDim2.new(1, 0, 0.3, 0)
nameBox.Position = UDim2.new(0, 0, 0.3, 0)
nameBox.PlaceholderText = "Enter target name"
nameBox.PlaceholderColor3 = Color3.new(0, 0, 0)
nameBox.TextScaled = true
nameBox.Text = ""

local aimButton = Instance.new("TextButton", guiContainer)
aimButton.Size = UDim2.new(0.5, 0, 0.3, 0)
aimButton.Position = UDim2.new(0, 0, 0.6, 0)
aimButton.Text = "AIM"
aimButton.BackgroundColor3 = Color3.new(1, 0, 0)
aimButton.TextScaled = true

local espButton = Instance.new("TextButton", guiContainer)
espButton.Size = UDim2.new(0.5, 0, 0.3, 0)
espButton.Position = UDim2.new(0.5, 0, 0.6, 0)
espButton.Text = "ESP"
espButton.BackgroundColor3 = Color3.new(1, 0, 0)
espButton.TextScaled = true

aimKeyBox = Instance.new("TextBox", guiContainer)
aimKeyBox.ClearTextOnFocus = false
aimKeyBox.Size = UDim2.new(0.3, 0, 0.3, 0)
aimKeyBox.Position = UDim2.new(0.7, 0, 0.3, 0)
aimKeyBox.PlaceholderText = "Enter Aim Key"
aimKeyBox.PlaceholderColor3 = Color3.new(0, 0, 0)
aimKeyBox.TextScaled = true
aimKeyBox.Text = aimKey
aimKeyBox.ClearTextOnFocus = false

espKeyBox = Instance.new("TextBox", guiContainer)
espKeyBox.ClearTextOnFocus = false
espKeyBox.Size = UDim2.new(0.3, 0, 0.3, 0)
espKeyBox.Position = UDim2.new(0.7, 0, 0.6, 0)
espKeyBox.PlaceholderText = "Enter ESP Key"
espKeyBox.PlaceholderColor3 = Color3.new(0, 0, 0)
espKeyBox.TextScaled = true
espKeyBox.Text = espKey
espKeyBox.ClearTextOnFocus = false

-- Functions
local function findTarget()
    target = nil
    local closestDistance = aimDistance or math.huge
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local char = player.Character
            local rootPart = char:FindFirstChild("HumanoidRootPart")
            local distance = (LocalPlayer.Character.HumanoidRootPart.Position - rootPart.Position).Magnitude
            if (targetName == "" or player.Name == targetName) and distance < closestDistance then
                target = rootPart
                closestDistance = distance
            end
        end
    end
end

local function aimAtTarget()
    if Aim_Enabled and target then
        local distance = (LocalPlayer.Character.HumanoidRootPart.Position - target.Position).Magnitude
        if aimDistance and distance < aimDistance then
            local targetPos = target.Position
            local camPos = camera.CFrame.Position
            local newCFrame = CFrame.new(camPos, targetPos)
            camera.CFrame = camera.CFrame:Lerp(newCFrame, aimSmoothness)
        else
            target = nil
        end
    end
end

local function updateESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local character = player.Character
            local highlight = character:FindFirstChild("ESP_Highlight")
            if ESP_Enabled and player.Name == targetName then
                if not highlight then
                    highlight = Instance.new("Highlight")
                    highlight.Name = "ESP_Highlight"
                    highlight.Parent = character
                    highlight.FillColor = Color3.fromRGB(255, 0, 0)
                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                    highlight.FillTransparency = 0.5
                    highlight.OutlineTransparency = 0
                end
            else
                if highlight then
                    highlight:Destroy()
                end
            end
        end
    end
end

-- Event handler
local function toggleAIM()
    Aim_Enabled = not Aim_Enabled
    aimButton.BackgroundColor3 = Aim_Enabled and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "丘덢잺AIM丘덢잺",
        Text = Aim_Enabled and "游릭AIM ON游릭" or "游댮AIM OFF游댮",
        Duration = 2
    })
end

local function toggleESP()
    ESP_Enabled = not ESP_Enabled
    espButton.BackgroundColor3 = ESP_Enabled and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "游댍ESP游댌",
        Text = ESP_Enabled and "游릭ESP ON游릭" or "游댮ESP OFF游댮",
        Duration = 2
    })
end

local function toggleGUI()
    UI_Visible = not UI_Visible
    guiContainer.Visible = UI_Visible
end

aimButton.MouseButton1Click:Connect(toggleAIM)
espButton.MouseButton1Click:Connect(toggleESP)
toggleButton.MouseButton1Click:Connect(toggleGUI)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end

    if aimKey ~= "" and input.KeyCode == Enum.KeyCode[aimKey] then
        toggleAIM()
    end

    if espKey ~= "" and input.KeyCode == Enum.KeyCode[espKey] then
        toggleESP()
    end

    if input.KeyCode == Enum.KeyCode.RightShift then
        toggleGUI()
    end
end)

aimKeyBox.FocusLost:Connect(function()
    local input = aimKeyBox.Text:upper()
    if string.match(input, "^[A-Z0-9]$") then
        aimKey = input
        aimKeyBox.Text = input
    else
        aimKeyBox.Text = "" 
    end
end)

espKeyBox.FocusLost:Connect(function()
    local input = espKeyBox.Text:upper()
    if string.match(input, "^[A-Z0-9]$") then
        espKey = input
        espKeyBox.Text = input
    else
        espKeyBox.Text = ""
    end
end)

nameBox.FocusLost:Connect(function()
    targetName = nameBox.Text
    updateESP()
end)

distanceBox.FocusLost:Connect(function()
    local input = tonumber(distanceBox.Text)
    if input then
        aimDistance = input
    else
        distanceBox.Text = ""
        aimDistance = nil
    end
end)

smoothnessBox.FocusLost:Connect(function()
    local smoothnessInput = tonumber(smoothnessBox.Text)
    if smoothnessInput then
        aimSmoothness = smoothnessInput
    else
        smoothnessBox.Text = ""
        aimSmoothness = nil
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if player.Name == targetName then
        targetName = ""
        updateESP()
    end
end)

game:GetService("RunService").RenderStepped:Connect(function()
    findTarget()
    aimAtTarget()
end)

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "游리Welcome游리",
    Text = "丘멆잺Right Shift to open/close GUI丘멆잺",
    Duration = 3
})
